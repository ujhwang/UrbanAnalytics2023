"0","# FUNCTION"
"0","get_yelp <- function(tract, category){"
"0","  # ----------------------------------"
"0","  # Gets one row of tract information (1,) and category name (str),"
"0","  # Outputs a list of business data.frame"
"0","  Sys.sleep(2)"
"0","  n <- 1"
"0","  # First request --------------------------------------------------------------"
"0","  resp <- business_search(api_key = Sys.getenv(""yelp_api""), "
"0","                          categories = category, "
"0","                          latitude = tract$y, "
"0","                          longitude = tract$x, "
"0","                          offset = (n - 1) * 50, # = 0 when n = 1"
"0","                          radius = round(tract$radius), "
"0","                          limit = 50)"
"0","  # Calculate how many requests are needed in total"
"0","  required_n <- ceiling(resp$total/50)"
"0","  "
"0","  # out is where the results will be appended to."
"0","  out <- vector(""list"", required_n)"
"0","  "
"0","  # Store the business information to nth slot in out"
"0","  out[[n]] <- resp$businesses"
"0","  "
"0","  # Change the name of the elements to the total required_n"
"0","  # This is to know if there are more than 1000 businesses,"
"0","  # we know how many."
"0","  names(out)[n] <- required_n"
"0","  "
"0","  # Throw error if more than 1000"
"0","  if (resp$total >= 1000)"
"0","  {"
"0","    # glue formats string by inserting {n} with what's currently stored in object n."
"0","    print(glue::glue(""{n}th row has >= 1000 businesses.""))"
"0","    # Stop before going into the loop because we need to"
"0","    # break down Census Tract to something smaller."
"0","    return(out)"
"0","  } "
"0","  else "
"0","  {"
"0","    # add 1 to n"
"0","    n <- n + 1"
"0","    "
"0","    # Now we know required_n -----------------------------------------------------"
"0","    # Starting a loop"
"0","    while(n <= required_n){"
"0","      resp <- business_search(api_key = Sys.getenv(""yelp_api""), "
"0","                              categories = category, "
"0","                              latitude = tract$y, "
"0","                              longitude = tract$x, "
"0","                              offset = (n - 1) * 50, "
"0","                              radius = round(tract$radius), "
"0","                              limit = 50)"
"0","      "
"0","      out[[n]] <- resp$businesses"
"0","      "
"0","      n <- n + 1"
"0","    } #<< end of while loop"
"0","    "
"0","    # Merge all elements in the list into a single data frame"
"0","    out <- out %>% bind_rows()"
"0","    "
"0","    return(out)"
"0","  }"
"0","}"
